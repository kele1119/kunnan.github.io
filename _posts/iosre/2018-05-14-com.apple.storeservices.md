---
layout: post
title: com.apple.storeservices
date: 2018-05-14
tag: iosre
site: https://zhangkn.github.io
catalog: true
author: kunnan
subtitle: StoreServices.framework的应用
---


# 前言

>* [iOS10-Runtime-Headers/PrivateFrameworks/StoreServices.framework/SSAccountStore.h](https://github.com/zhangkn/iOS10-Runtime-Headers)
>


>* [清理](https://github.com/kunnan/KNiosreTool/blob/master/KNiosreTool/file/KNdelateDirTool.m)
>```
>/var/mobile/Library/Caches/com.apple.storeservices
>/var/mobile/Library/Caches/com.apple.storeservices/SSAppImageDatabaseCacheEntry
>```

>*  实现自动登录AppleID，要结合`    [[UIApplication sharedApplication] launchApplicationWithIdentifier:@"com.tencent.xin" suspended:0];
` 一起
><script src="https://gist.github.com/zhangkn/420901daf61fc6fd25c2501ed4b6fb62.js"></script>
>



# [SSAccountStore](https://github.com/zhangkn/iOS10-Runtime-Headers/blob/master/PrivateFrameworks/StoreServices.framework/SSAccountStore.h)


>*  注销`- (void)signOutAllAccounts;`
>```
>[SSAccountStore performSelectorOnMainThread:@selector(signOutAllAccounts) withObject:nil waitUntilDone:NO];
>```
>
>* 获取对象
>```
>id SSAccountStore = [objc_getClass("SSAccountStore") defaultStore];
id account = [SSAccountStore activeAccount];
>```




# [`SSClientAccountStore : SSAccountStore`](https://github.com/zhangkn/iOS10-Runtime-Headers/blob/master/PrivateFrameworks/StoreServices.framework/SSClientAccountStore.h)



#### 使用MSHookMessageEx 或者%hook 进行处理`updateAccountsWithMessage`

>* `- (void)updateAccountsWithMessage:(id)arg1 completionBlock:(id /* block */)arg2;`
>```
>        id SSAccountStore = [objc_getClass("SSAccountStore") defaultStore];
>```

>* 获取当前活跃的账户
>```
>[SSAccountStore activeAccount] accountName] 
>```



# 在preference中登录APPleID


#### 思路一： 利用设置app进行登录

>* 打开Preferences
>```
>/Applications/Preferences.app/Preferences
>            [Tools launchApp:@"com.apple.Preferences"];
>```


>* [打开app页面](https://github.com/kunnan/KNiosreTool/blob/master/KNiosreTool/openURL/KNopenURL.m)
>


#### 思路二： 下载的时候，在app store中拦截弹框，判断弹框标题`需要登录`进行处理

>* 利用hook 系统的弹框( 可以是创建的方法`CFUserNotificationCreate `)，去掉烦人的弹框
>```objc
>//未安装 SIM 卡
>本质上就是修改返回值： CFUserNotificationRef ，其实就是一个字典
>```
>


# [CFUserNotification](https://github.com/kunnan/CoreFoundation/blob/master/CFUserNotification.h)

>* [CFUserNotification.h](https://github.com/kunnan/Tools/blob/master/CFUserNotification.h)

>* [CFUserNotification.c](https://github.com/kunnan/CoreFoundation/blob/master/CFUserNotification.c)
><script src="https://gist.github.com/zhangkn/d58afd44224a2b6847699a56000b33b5.js"></script>


# CFUserNotificationCreate

>* [CFUserNotificationCreate](https://developer.apple.com/documentation/corefoundation/1534528-cfusernotificationcreate?language=objc)
><script src="https://gist.github.com/zhangkn/7d776435fd56b01034b68bbd0c5adb2c.js"></script>


>* CFUserNotificationCreate 使用的简单例子
><script src="https://gist.github.com/zhangkn/5f8a0454ef2c0d252002fa9a5956706d.js"></script>
>```
>CFDictionaryRef dictionary ,存储这个标题和内容的字典对象； 可以使用kCFUserNotification 进行操作，也可以采用桥接的方式
>NSDictionary* dict = (NSDictionary*) dictionary;
>```
><script src="https://gist.github.com/zhangkn/7a4404407c989430ff188adf93c9e9be.js"></script>



#### CFUserNotificationCreate  在theos 中使用的例子

>* framework
>```
>devzkndeMacBook-Pro:UIDeviceCrasher devzkn$ /Users/devzkn/code/iosre/UIDeviceCrasher/framework/include/CoreFoundation/CFUserNotification.h 
>```

>* /opt/theos/include 应当放入一些CoreFoundation的头文件
>


>* [更多的使用例子](https://github.com/search?l=Logos&q=CFUserNotificationCreate&type=Code)
>



# See Also 

>* [CoreFoundation](https://github.com/kunnan/CoreFoundation)


>* [diskdev_cmds](https://github.com/naota/diskdev_cmds/blob/73f17c3b6543b6224c0958a649783809a833dace/nofs.tproj/ui.c)
>
>
>* [Tools](https://github.com/kunnan/Tools)
>
>* [adowngrader](https://github.com/H6nry/H6nry-iPhone/tree/3de0c96ff07098a0c704d07f28a82cd7e81e4c66/adowngrader)
>```
>https://github.com/noteblogpost/H6nry-iPhone
>```

>* [谓词NSPredicate技术的应用](https://blog.csdn.net/z929118967/article/details/74066170)

>* [深夜福利！越狱iOS清痕暨■■■■■■■■核心代码の无料放送-clearTrace](http://bbs.iosre.com/t/ios-igrimace/448)

>* [knpost](https://github.com/zhangkn/KNBin/blob/master/knpost) 
>
```
/Users/devzkn/bin/knpost com.apple.storeservices StoreServices.framework的应用 -t iosre
> #原来""的参数，需要自己加上""
```

